const TelegramBot = require('node-telegram-bot-api');
// const admin = require('firebase-admin'); // –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å

// ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
// –¢–æ–∫–µ–Ω —Ç–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∏—Ö –º—ã –∑–∞–¥–∞–¥–∏–º –Ω–∞ Render)
const TOKEN = process.env.TOKEN;

// URL —Ç–≤–æ–µ–π –∏–≥—Ä—ã –Ω–∞ GitHub Pages (–æ—Å—Ç–∞–≤—å –∫–∞–∫ –µ—Å—Ç—å)
const WEB_APP_URL = 'https://sleepdose.github.io/tapbot';

// –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç–æ–∫–µ–Ω –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
if (!TOKEN) {
  console.error('–û—à–∏–±–∫–∞: –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è TOKEN –∑–∞–¥–∞–Ω–∞.');
  process.exit(1);
}

// –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
const bot = new TelegramBot(TOKEN, { polling: true });

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
bot.onText(/\/start/, async (msg) => {
  const chatId = msg.chat.id;
  const userId = msg.from.id;
  const firstName = msg.from.first_name || '–ò–≥—Ä–æ–∫';

  const welcomeText = `
–ü—Ä–∏–≤–µ—Ç, ${firstName}! üëã

üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ ¬´Hiko Adventure¬ª!

–¢—ã –ø–æ–ø–∞–ª –≤ –∏–≥—Ä—É, –≥–¥–µ –º–æ–∂–Ω–æ:
‚Äî ‚öîÔ∏è —Å—Ä–∞–∂–∞—Ç—å—Å—è —Å –±–æ—Å—Å–∞–º–∏ –≤–º–µ—Å—Ç–µ —Å –≥–∏–ª—å–¥–∏–µ–π;
‚Äî üé© –º–µ–Ω—è—Ç—å —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É –∏ –ø–∏—Ç–æ–º—Ü–µ–≤;
‚Äî ‚ú® –ø—Ä–æ–∫–∞—á–∏–≤–∞—Ç—å —Ç–∞–ª–∞–Ω—Ç—ã –∏ –∫—Ä–∞—Ñ—Ç–∏—Ç—å –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏;
‚Äî üè∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ—é –≥–∏–ª—å–¥–∏—é –∏–ª–∏ –≤—Å—Ç—É–ø–∞—Ç—å –≤ –¥—Ä—É–≥–∏–µ.

–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É¬ª –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!
  `;

  const keyboard = {
    inline_keyboard: [
      [
        {
          text: 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É',
          web_app: { url: WEB_APP_URL }
        }
      ]
    ]
  };

  await bot.sendMessage(chatId, welcomeText, {
    parse_mode: 'Markdown',
    reply_markup: keyboard
  });
});

console.log('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Å–ª—É—à–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã...');
